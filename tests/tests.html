<link rel="stylesheet" type="text/css" href="../lib/css/jasmine.css">

<script src="../lib/js/jquery.js"></script>
<script type="text/javascript" src="../lib/js/jasmine.js"></script>
<script type="text/javascript" src="../lib/js/jasmine-html.js"></script>
<script type="text/javascript" src="../lib/js/boot.js"></script>
<script src="../lib/js/angular.min.js"></script>
<script type="text/javascript" src="../lib/ng-repeat-array/AngularRepeatArray.js"></script>
<script type="text/javascript" src="../lib/js/checklist.js"></script>


<script>

describe("Filtering by type", function() {
  const tasks = [
    {id: 1, type: 'apple'},
    {id: 2, type: 'bananana'},
    {id: 3, type: 'apple'},
    {id: 4, type: 'pear'}
  ];

  it("returns the correct tasks", function() {
    const results = filterTasksByType(tasks, 'apple');

    expect(results.length).toBe(2);
    expect(results[0].id).toBe(1);
    expect(results[1].id).toBe(3);
  });

  it("returns a blank array when there are no matching types", function() {
    const results = filterTasksByType(tasks, 'applesauce');

    expect(results.length).toBe(0);
    expect(results).toEqual([]);
  });
});


describe("Filtering tasks by required answer", function() {
  it("returns the correct tasks when there is 1 required yes", function() {
    const tasks = [
      {id: 1, type: '', questionsRequiredYes: [1], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: []},
      {id: 2, type: '', questionsRequiredYes: [2], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: []}
    ];
    const questions = [
      {id: 1, text: '', description: '', default: true},
      {id: 2, text: '', description: '', default: false}
    ];
    const results = filterTasksByRequired(tasks, questions, true);

    expect(results.length).toBe(1);
    expect(results[0].id).toBe(1);
  });

  it("returns the correct tasks when there are 2 required yes", function() {
    const tasks = [
      {id: 1, type: '', questionsRequiredYes: [1, 2], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: []},
      {id: 2, type: '', questionsRequiredYes: [3], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: []}
    ];
    const questions = [
      {id: 1, text: '', description: '', default: true},
      {id: 2, text: '', description: '', default: true},
      {id: 3, text: '', description: '', default: false}
    ];
    const results = filterTasksByRequired(tasks, questions, true);

    expect(results.length).toBe(1);
    expect(results[0].id).toBe(1);
  });

  it("returns the correct tasks when there is 1 required no", function() {
    const tasks = [
      {id: 1, type: '', questionsRequiredYes: [], questionsRequiredNo: [1], questionsAnyYes: [], questionsAnyNo: []},
      {id: 2, type: '', questionsRequiredYes: [], questionsRequiredNo: [2], questionsAnyYes: [], questionsAnyNo: []}
    ];
    const questions = [
      {id: 1, text: '', description: '', default: false},
      {id: 2, text: '', description: '', default: true}
    ];
    const results = filterTasksByRequired(tasks, questions, false);

    expect(results.length).toBe(1);
    expect(results[0].id).toBe(1);
  });

  it("returns the correct tasks when there are 2 required no", function() {
    const tasks = [
      {id: 1, type: '', questionsRequiredYes: [], questionsRequiredNo: [1, 2], questionsAnyYes: [], questionsAnyNo: []},
      {id: 2, type: '', questionsRequiredYes: [], questionsRequiredNo: [3], questionsAnyYes: [], questionsAnyNo: []}
    ];
    const questions = [
      {id: 1, text: '', description: '', default: false},
      {id: 2, text: '', description: '', default: false},
      {id: 3, text: '', description: '', default: true}
    ];
    const results = filterTasksByRequired(tasks, questions, false);

    expect(results.length).toBe(1);
    expect(results[0].id).toBe(1);
  });

  it("returns the correct tasks when questions dont exist required yes", function() {
    const tasks = [
      {id: 1, type: '', questionsRequiredYes: [1, 2], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: []},
      {id: 2, type: '', questionsRequiredYes: [3], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: []}
    ];
    const questions = [
      {id: 1, text: '', description: '', default: true},
      {id: 2, text: '', description: '', default: true},
    ];
    const results = filterTasksByRequired(tasks, questions, true);

    expect(results.length).toBe(1);
    expect(results[0].id).toBe(1);
  });

  it("returns the correct tasks when questions dont exist required no", function() {
    const tasks = [
      {id: 1, type: '', questionsRequiredYes: [], questionsRequiredNo: [1, 2], questionsAnyYes: [], questionsAnyNo: []},
      {id: 2, type: '', questionsRequiredYes: [], questionsRequiredNo: [3], questionsAnyYes: [], questionsAnyNo: []}
    ];
    const questions = [
      {id: 1, text: '', description: '', default: false},
      {id: 2, text: '', description: '', default: false},
    ];
    const results = filterTasksByRequired(tasks, questions, false);

    expect(results.length).toBe(1);
    expect(results[0].id).toBe(1);
  });

  it("returns the correct tasks when there are no questions required yes", function() {
    const tasks = [
      {id: 1, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: []},
      {id: 2, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: []}
    ];
    const questions = [
      {id: 1, text: '', description: '', default: false},
      {id: 2, text: '', description: '', default: false},
    ];
    const results = filterTasksByRequired(tasks, questions, true);

    expect(results.length).toBe(2);
    expect(results[0].id).toBe(1);
    expect(results[1].id).toBe(2);
  });

  it("returns the correct tasks when there are no questions required no", function() {
    const tasks = [
      {id: 1, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: []},
      {id: 2, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: []}
    ];
    const questions = [
      {id: 1, text: '', description: '', default: false},
      {id: 2, text: '', description: '', default: false},
    ];
    const results = filterTasksByRequired(tasks, questions, false);

    expect(results.length).toBe(2);
    expect(results[0].id).toBe(1);
    expect(results[1].id).toBe(2);
  });

  it("returns the correct tasks when going from a task with no questions to a task with questions required yes", function() {
    const tasks = [
      {id: 1, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: []},
      {id: 2, type: '', questionsRequiredYes: [1], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: []}
    ];
    const questions = [
      {id: 1, text: '', description: '', default: false},
      {id: 2, text: '', description: '', default: false},
    ];
    const results = filterTasksByRequired(tasks, questions, true);

    expect(results.length).toBe(1);
    expect(results[0].id).toBe(1);
  });

  it("returns the correct tasks when going for a task with questions to a task with no questions required yes", function() {
    const tasks = [
      {id: 1, type: '', questionsRequiredYes: [1], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: []},
      {id: 2, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: []}
    ];
    const questions = [
      {id: 1, text: '', description: '', default: false},
      {id: 2, text: '', description: '', default: false},
    ];
    const results = filterTasksByRequired(tasks, questions, true);

    expect(results.length).toBe(1);
    expect(results[0].id).toBe(2);
  });
});


describe("Finding the value of a question", function() {
  const tasks = [
    {id: 1, type: '', questionsRequiredYes: [1], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: []},
    {id: 2, type: '', questionsRequiredYes: [2], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: []}
  ];
  const questions = [
    {id: 1, text: '', description: '', default: true},
    {id: 2, text: '', description: '', default: false}
  ];

  it("returns the correct questions value", function() {
    const results = findQuestion(questions, 1);
    expect(results).toEqual({id: 1, text: '', description: '', default: true});
  });

  it("returns undefined when question does not exist", function() {
    const results = findQuestion(questions, 3);
    expect(results).toBe(undefined);
  });
});

describe("Filtering tasks by the any answer property", function() {

  it("returns the correct tasks when there is 1 any yes", function() {
    const tasks = [
      {id: 1, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [1], questionsAnyNo: []},
      {id: 2, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [2], questionsAnyNo: []}
    ];
    const questions = [
      {id: 1, text: '', description: '', default: true},
      {id: 2, text: '', description: '', default: false},
    ];
    const results = filterTasksByAny(tasks, questions, true);

    expect(results.length).toBe(1);
    expect(results[0].id).toBe(1);
  });

  it("returns the correct tasks when there are 2 any yes", function() {
    const tasks = [
      {id: 1, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [1, 2], questionsAnyNo: []},
      {id: 2, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [3], questionsAnyNo: []}
    ];
    const questions = [
      {id: 1, text: '', description: '', default: false},
      {id: 2, text: '', description: '', default: true},
      {id: 3, text: '', description: '', default: false}
    ];
    const results = filterTasksByAny(tasks, questions, true);

    expect(results.length).toBe(1);
    expect(results[0].id).toBe(1);
  });

  it("returns the correct tasks when there is 1 any no", function() {
    const tasks = [
      {id: 1, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: [1]},
      {id: 2, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: [2]}
    ];
    const questions = [
      {id: 1, text: '', description: '', default: false},
      {id: 2, text: '', description: '', default: true},
    ];
    const results = filterTasksByAny(tasks, questions, false);
    expect(results.length).toBe(1);
    expect(results[0].id).toBe(1);
  });

  it("returns the correct tasks when there are 2 any no", function() {
    const tasks = [
      {id: 1, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: [1, 2]},
      {id: 2, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: [3]}
    ];
    const questions = [
      {id: 1, text: '', description: '', default: true},
      {id: 2, text: '', description: '', default: false},
      {id: 3, text: '', description: '', default: true}
    ];
    const results = filterTasksByAny(tasks, questions, false);

    expect(results.length).toBe(1);
    expect(results[0].id).toBe(1);
  });

  it("returns the correct tasks when questions dont exist when any is no", function() {
    const tasks = [
      {id: 1, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: [1, 2]},
      {id: 2, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: [5]}
    ];
    const questions = [
      {id: 1, text: '', description: '', default: true},
      {id: 2, text: '', description: '', default: false},
      {id: 3, text: '', description: '', default: true}
    ];
    const results = filterTasksByAny(tasks, questions, false);

    expect(results.length).toBe(1);
    expect(results[0].id).toBe(1);
  });

  it("returns the correct tasks when questions dont exist when any is yes", function() {
    const tasks = [
      {id: 1, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [1, 2], questionsAnyNo: []},
      {id: 2, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [5], questionsAnyNo: []}
    ];
    const questions = [
      {id: 1, text: '', description: '', default: false},
      {id: 2, text: '', description: '', default: true},
      {id: 3, text: '', description: '', default: false}
    ];
    const results = filterTasksByAny(tasks, questions, true);

    expect(results.length).toBe(1);
    expect(results[0].id).toBe(1);
  });

  it("returns the correct tasks when there are no where any is yes", function() {
    const tasks = [
      {id: 1, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: []},
      {id: 2, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: []}
    ];
    const questions = [
      {id: 1, text: '', description: '', default: false},
      {id: 2, text: '', description: '', default: true},
      {id: 3, text: '', description: '', default: false}
    ];
    const results = filterTasksByAny(tasks, questions, true);

    expect(results.length).toBe(2);
    expect(results[0].id).toBe(1);
    expect(results[1].id).toBe(2);
  });

  it("returns the correct tasks when there are no where any is no", function() {
    const tasks = [
      {id: 1, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: []},
      {id: 2, type: '', questionsRequiredYes: [], questionsRequiredNo: [], questionsAnyYes: [], questionsAnyNo: []}
    ];
    const questions = [
      {id: 1, text: '', description: '', default: false},
      {id: 2, text: '', description: '', default: true},
      {id: 3, text: '', description: '', default: false}
    ];
    const results = filterTasksByAny(tasks, questions, false);

    expect(results.length).toBe(2);
    expect(results[0].id).toBe(1);
    expect(results[1].id).toBe(2);
  });
});

describe("Finding the owner of the task", function() {
  const roles = [
    {name: 1, value: 'apple'},
    {name: 2, value: 'pear'}
  ];

  it("returns the correct owner based on role", function() {
    const results = getOwnerProperty(roles, 'name', 1, 'value');
    expect(results).toBe('apple');
  });

  it("returns empty when there are no owners", function() {
    const results = getOwnerProperty(roles, 'name', 3, 'value');
    expect(results).toEqual('');
  });

  it("returns empty when the property does not exist in the role", function() {
    const results = getOwnerProperty(roles, 'name', 2, 'role');
    expect(results).toEqual('');
  });
});

describe("Changing the property of a JSON object", function() {

  it("returns the correct change on the object", function() {
    const roles = [
      {name: 1, value: 'apple'},
      {name: 2, value: 'pear'}
    ];
    const role = {name: 1}
    const results = changeRoleValue(roles, 'name', role, 'value', 10);

    expect(results.length).toBe(2);
    expect(results[0].value).toBe(10);
  });

  it("returns the original json array when there are no common properties", function() {
    const roles = [
      {name: 1, value: 'apple'},
      {name: 2, value: 'pear'}
    ];
    const role = {name: 1}
    const results = changeRoleValue(roles, 'blah', role, 'value', 10);

    expect(results.length).toBe(2);
    expect(results[0].value).toBe('apple')
    expect(results[1].value).toBe('pear');
  });

});

</script>
